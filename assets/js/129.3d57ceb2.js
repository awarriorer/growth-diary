(window.webpackJsonp=window.webpackJsonp||[]).push([[129],{441:function(t,a,e){"use strict";e.r(a);var s=e(14),n=Object(s.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h3",{attrs:{id:"组件内部状态小结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#组件内部状态小结"}},[t._v("#")]),t._v(" 组件内部状态小结")]),t._v(" "),a("p",[t._v("通过前一篇文章，我们现在知道，当我初始化一个"),a("code",[t._v("vue")]),t._v("实例的时候，其内部会将我们传入的"),a("code",[t._v("props, methods, data, computed, watch")]),t._v("选项做一些预处理后，然后再挂载到我们的当前实例"),a("code",[t._v("this")]),t._v("上")]),t._v(" "),a("p",[t._v("下面以一个简单的小例子说明问题。")]),t._v(" "),a("h4",{attrs:{id:"例子"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#例子"}},[t._v("#")]),t._v(" 例子：")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Vue")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("props")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" String"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'uncle-yang'")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("data")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("age")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("30")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("computed")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("showInfo")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("my name is ")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v(", i'm ")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("age"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("watch")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("age")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("newVal"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" oldVal")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("my new age is ")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("newVal"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("methods")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getName")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("Hello! i'm ")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br"),a("span",{staticClass:"line-number"},[t._v("23")]),a("br"),a("span",{staticClass:"line-number"},[t._v("24")]),a("br"),a("span",{staticClass:"line-number"},[t._v("25")]),a("br"),a("span",{staticClass:"line-number"},[t._v("26")]),a("br")])]),a("h4",{attrs:{id:"props"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#props"}},[t._v("#")]),t._v(" props")]),t._v(" "),a("ul",[a("li",[t._v("获取到"),a("code",[t._v("props")]),t._v("选项")]),t._v(" "),a("li",[t._v("定义内部变量"),a("code",[t._v("_props")])]),t._v(" "),a("li",[t._v("调用"),a("code",[t._v("validateProp()")]),t._v("验证，获取"),a("code",[t._v("name")]),t._v("的值")]),t._v(" "),a("li",[t._v("通过"),a("code",[t._v("defineReactive")]),t._v("把"),a("code",[t._v("name")]),t._v("的值挂在"),a("code",[t._v("_props")]),t._v("上，且完成数据劫持\n"),a("ul",[a("li",[t._v("生成和"),a("code",[t._v("name")]),t._v("相关的"),a("code",[t._v("Dep")]),t._v("实例")]),t._v(" "),a("li",[t._v("当访问"),a("code",[t._v("name")]),t._v("值的时候触发"),a("code",[t._v("getter")]),t._v("函数，有"),a("code",[t._v("Dep.target")]),t._v("的情况下会收集依赖")]),t._v(" "),a("li",[t._v("当设置"),a("code",[t._v("name")]),t._v("值的时候触发"),a("code",[t._v("setter")]),t._v("函数，调用"),a("code",[t._v("dep.notify")]),t._v("通知依赖"),a("code",[t._v("name")]),t._v("的"),a("code",[t._v("Watcher")]),t._v("实例")])])]),t._v(" "),a("li",[t._v("把值通过"),a("code",[t._v("proxy")]),t._v("挂载"),a("code",[t._v("this")]),t._v("(到当前实例)上，以便于当访问"),a("code",[t._v("this.name")]),t._v("的时候直接响应到上述逻辑")])]),t._v(" "),a("h4",{attrs:{id:"methods"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#methods"}},[t._v("#")]),t._v(" methods")]),t._v(" "),a("ul",[a("li",[t._v("获取到"),a("code",[t._v("props")]),t._v("选项")]),t._v(" "),a("li",[t._v("通过"),a("code",[t._v("bind")]),t._v("方法改变"),a("code",[t._v("getName")]),t._v("函数的"),a("code",[t._v("this")]),t._v("指向")]),t._v(" "),a("li",[t._v("把改变了"),a("code",[t._v("this")]),t._v("指向的"),a("code",[t._v("getName")]),t._v("函数挂载到当前"),a("code",[t._v("vue")]),t._v("实例上")])]),t._v(" "),a("h4",{attrs:{id:"data"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#data"}},[t._v("#")]),t._v(" data")]),t._v(" "),a("ul",[a("li",[t._v("获取到"),a("code",[t._v("data")]),t._v("选项(一个函数)")]),t._v(" "),a("li",[t._v("调用"),a("code",[t._v("getData")]),t._v("函数获取"),a("code",[t._v("data")]),t._v("函数中返回的对象"),a("code",[t._v("{age: 30}")])]),t._v(" "),a("li",[t._v("定义内部变量"),a("code",[t._v("_data")]),t._v("，且指向上述返回的对象"),a("code",[t._v("{age: 30}")])]),t._v(" "),a("li",[t._v("调用"),a("code",[t._v("proxy")]),t._v("函数，把"),a("code",[t._v("_data")]),t._v("中的属性("),a("code",[t._v("age")]),t._v(")代理到"),a("code",[t._v("this")]),t._v("(当前实例)上")]),t._v(" "),a("li",[t._v("调用"),a("code",[t._v("observe")]),t._v("函数得到一个"),a("code",[t._v("Oberver")]),t._v("实例\n"),a("ul",[a("li",[a("code",[t._v("Oberver")]),t._v("中，通过调用"),a("code",[t._v("defineReactive")]),t._v("来观察"),a("code",[t._v("_data")]),t._v("的"),a("code",[t._v("age")]),t._v("属性")])])])]),t._v(" "),a("h4",{attrs:{id:"computed"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#computed"}},[t._v("#")]),t._v(" computed")]),t._v(" "),a("ul",[a("li",[t._v("获取到"),a("code",[t._v("computed")]),t._v("选项")]),t._v(" "),a("li",[t._v("定义内部变量"),a("code",[t._v("_computedWatchers")])]),t._v(" "),a("li",[t._v("创建"),a("code",[t._v("showInfo")]),t._v("对应的"),a("code",[t._v("Watcher")]),t._v("实例,并且把该实例缓存到"),a("code",[t._v("_computedWatchers")]),t._v(" "),a("ul",[a("li",[t._v("其中"),a("code",[t._v("showInfo")]),t._v("函数传入了"),a("code",[t._v("Watcher")]),t._v("对应的"),a("code",[t._v("expOrFn")]),t._v("变量")]),t._v(" "),a("li",[t._v("而"),a("code",[t._v("expOrFn")]),t._v("被"),a("code",[t._v("Watcher")]),t._v("内部的"),a("code",[t._v("get")]),t._v("函数包装")]),t._v(" "),a("li",[a("code",[t._v("get")]),t._v("函数执行时，会先调用"),a("code",[t._v("pushTarget")]),t._v("函数开启收集依赖的关")]),t._v(" "),a("li",[t._v("再执行把"),a("code",[t._v("this")]),t._v("指向当前"),a("code",[t._v("vue")]),t._v("实例的函数"),a("code",[t._v("function(){return ‘my name is ${this.name}, i'm ${this.age}’}")])]),t._v(" "),a("li",[t._v("当函数运行到"),a("code",[t._v("this.name")]),t._v("和"),a("code",[t._v("this.age")]),t._v("时，触发其各自被"),a("code",[t._v("defineReactive")]),t._v("劫持的"),a("code",[t._v("getter")]),t._v("函数")]),t._v(" "),a("li",[t._v("此时"),a("code",[t._v("Dep.target")]),t._v("有"),a("code",[t._v("_computedWatchers[showInfo]")]),t._v("对应的"),a("code",[t._v("Watcher")]),t._v("实例，从而执行"),a("code",[t._v("getter")]),t._v("中的"),a("code",[t._v("dep.depend()")])]),t._v(" "),a("li",[t._v("然后执行"),a("code",[t._v("_computedWatchers[showInfo].addDep(dep)")])]),t._v(" "),a("li",[t._v("在"),a("code",[t._v("Watcher.addDep")]),t._v("函数中，又把"),a("code",[t._v("_computedWatchers[showInfo]")]),t._v("对应的"),a("code",[t._v("Watcher")]),t._v("实例"),a("code",[t._v("push")]),t._v("到了"),a("code",[t._v("dep.subs")]),t._v("数组中")]),t._v(" "),a("li",[t._v("从此完成"),a("code",[t._v("showInfo")]),t._v("对"),a("code",[t._v("name")]),t._v("和"),a("code",[t._v("age")]),t._v("依赖的收集")]),t._v(" "),a("li",[t._v("且得到了函数运行的值"),a("code",[t._v("my name is uncle-yang, i'm 30")]),t._v("，并且赋值给"),a("code",[t._v("Watcher.value")])]),t._v(" "),a("li",[t._v("当给"),a("code",[t._v("name")]),t._v("和"),a("code",[t._v("age")]),t._v("设置新值时，触发其各自被"),a("code",[t._v("defineReactive")]),t._v("劫持的"),a("code",[t._v("setter")]),t._v("函数")]),t._v(" "),a("li",[t._v("然后执行到"),a("code",[t._v("dep.notify()")])]),t._v(" "),a("li",[t._v("从而调用"),a("code",[t._v("dep.subs")]),t._v("中所有"),a("code",[t._v("Watcher.update")]),t._v("方法")]),t._v(" "),a("li",[t._v("由于"),a("code",[t._v("computed")]),t._v("默认选项"),a("code",[t._v("{lazy: true}")]),t._v("，所以只是改变了"),a("code",[t._v("Watcher")]),t._v("内部变量的值"),a("code",[t._v("dirty = true")])])])]),t._v(" "),a("li",[t._v("调用"),a("code",[t._v("createComputedGetter")]),t._v("把"),a("code",[t._v("showInfo")]),t._v("包装成一个对象，其"),a("code",[t._v("getter")]),t._v("返回"),a("code",[t._v("Watcher.value")])])]),t._v(" "),a("h4",{attrs:{id:"watch"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#watch"}},[t._v("#")]),t._v(" watch")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("获取到"),a("code",[t._v("watch")]),t._v("选项")])]),t._v(" "),a("li",[a("p",[t._v("获取到"),a("code",[t._v("age")]),t._v("选项")])]),t._v(" "),a("li",[a("p",[t._v("调用"),a("code",[t._v("this.$watch('age', ageFun)")]),t._v(",这个方法在"),a("code",[t._v("stateMixin")]),t._v("方法中混入")])]),t._v(" "),a("li",[a("p",[t._v("在"),a("code",[t._v("$watch")]),t._v("中执行"),a("code",[t._v("new Watcher(vm, 'age', ageFun, {user: true})")])]),t._v(" "),a("ul",[a("li",[t._v("在"),a("code",[t._v("watcher")]),t._v("实例中")]),t._v(" "),a("li",[a("code",[t._v("watcher.getter")]),t._v("为一个函数"),a("code",[t._v("function(){return vm.age}")])]),t._v(" "),a("li",[t._v("在调用"),a("code",[t._v("get")]),t._v("方法是完成"),a("code",[t._v("watcher")]),t._v("依赖的收集")]),t._v(" "),a("li",[t._v("当"),a("code",[t._v("age")]),t._v("改变时，触发传入的"),a("code",[t._v("ageFun")]),t._v("回调函数")])]),t._v(" "),a("h4",{attrs:{id:"小结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#小结"}},[t._v("#")]),t._v(" 小结")]),t._v(" "),a("ul",[a("li",[t._v("状态初始化的顺序是"),a("code",[t._v("props,method,data,computed,watch")]),t._v(",所以访问顺序也是有区别的，例如可以在"),a("code",[t._v("data")]),t._v("中访问"),a("code",[t._v("props")]),t._v("，但是不能反过来")])])])])])}),[],!1,null,null,null);a.default=n.exports}}]);