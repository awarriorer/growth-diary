(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{151:function(t,n,e){t.exports=e.p+"assets/img/jsonp-1.2861a8db.png"},158:function(t,n,e){"use strict";e.r(n);var s=[function(){var t=this,n=t.$createElement,s=t._self._c||n;return s("div",{staticClass:"content"},[s("h3",{attrs:{id:"日常跨域解决方案之-jsonp"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#日常跨域解决方案之-jsonp","aria-hidden":"true"}},[t._v("#")]),t._v(" 日常跨域解决方案之(jsonp)")]),s("p",[t._v("原理：静态资源(css,image,js)不受浏览器同源策略束缚\n本着能动手就别吵吵的原则，直接坐代码演示")]),s("p",[t._v("HTML")]),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n\t<meta charset=\"UTF-8\">\n\t<title>jsonp示例</title>\n</head>\n<body>\n\t<button id=\"but\">执行jsonp请求</button>\n\t\n\t<script type=\"text/javascript\">\n\t\twindow.onload = () =>{\n\t\t\tlet but = document.querySelector(\"#but\");\n\n\t\t\tbut.onclick = function(){\n\t\t\t\tcreateJsonp('http://127.0.0.1:3500/jsonp', function(res){\n\t\t\t\t\tconsole.log('jsonp响应...');\n\t\t\t\t\tconsole.log(res.data);\n\t\t\t\t})\n\t\t\t}\n\t\t}\n\n\t\t// 初始化请求个数\n\t\twindow.requestIndex = 0;\n\n\t\t// 创建一个jsonp请求\n\t\tfunction createJsonp(url, next){\n\n\t\t\t// 请求次数自增，避免下次请求时回调执行絮乱\n\t\t\trequestIndex++;\n\n\t\t\tlet funName = 'jsonpBack' + requestIndex;\n\t\t\tlet reqUrl  = url + '?callback=' + funName;\n\n\t\t\t// 定义回调名称\n\t\t\twindow[funName] = function(res){\n\t\t\t\t// 执行回调\n\t\t\t\tnext(res);\n\t\t\t\t// 删除已经当前执行过的script\n\t\t\t\tremoveScript(funName);\n\t\t\t}\n\n\t\t\t// 创建标签\n\t\t\tcreateScript(reqUrl, funName);\n\n\t\t\t// 创建script标签\n\t\t\tfunction createScript(requestUrl, id){\n\t\t\t\tlet script = document.createElement('script');\n\n\t\t\t\tscript.type = 'text/javascript';\n\t\t\t\tscript.src  = requestUrl;\n\t\t\t\tscript.id   = id;\n\n\t\t\t\t// 追加元素\n\t\t\t\tdocument.head.appendChild(script);\n\t\t\t}\n\n\t\t\t// 删除script 标签\n\t\t\tfunction removeScript(id){\n\t\t\t\tlet script = document.querySelector('#' + id);\n\n\t\t\t\tdocument.head.removeChild(script);\n\t\t\t}\n\n\t\t}\n\t<\/script>\n</body>\n</html>\n")])])]),s("p",[t._v("node server")]),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("var express = require('express');\nvar app     = express();\n\nvar resData = {\n\tstatus: 1,\n\tdata: 'Hi, this is uncle-yang.'\n}\n\napp.get('/jsonp', function(req, res){\n\tres.jsonp(resData);\n});\n\n// start server\nvar server = app.listen(3500, function(){\n\tvar host = server.address().address;\n  \tvar port = server.address().port;\n\n\tconsole.log('Example app listening at http://%s:%s', host, port);\n})\n")])])]),s("h4",{attrs:{id:"现象"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#现象","aria-hidden":"true"}},[t._v("#")]),t._v(" 现象")]),s("p",[t._v("点击请求按钮后，控制台打印出 "),s("code",[t._v("Hi, this is uncle-yang.")]),s("img",{attrs:{src:e(151),alt:"打印日志"}})]),s("h4",{attrs:{id:"jsonp-这个请求返回了什么？"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#jsonp-这个请求返回了什么？","aria-hidden":"true"}},[t._v("#")]),t._v(" jsonp 这个请求返回了什么？")]),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("/**/ typeof jsonpBack1 === 'function' && jsonpBack1({status: 1, data: \"Hi, this is uncle-yang.\"});\n")])])]),s("p",[t._v("检查查询参数callback的回调函数名称是否是一个函数，如果是函数，那么执行，且把数据传到jsonpBack1中")]),s("h4",{attrs:{id:"小结"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#小结","aria-hidden":"true"}},[t._v("#")]),t._v(" 小结")]),s("ul",[s("li",[t._v("本质\n"),s("ul",[s("li",[t._v("动态创建script标签，请求地址就是其src,服务器会返回一个js文件，里面执行了传递了结果的callback回调函数")]),s("li",[t._v('jsonp 只是一种 "使用模式",请求手段，或者说是一个解决方案')])])]),s("li",[t._v("缺点\n"),s("ul",[s("li",[t._v("因为是本质是script，所以只支持get请求，所以请求大小受限制")])])]),s("li",[t._v("优点\n"),s("ul",[s("li",[t._v("兼容性良好")])])])])])}],a=e(0),r=Object(a.a)({},function(){this.$createElement;this._self._c;return this._m(0)},s,!1,null,null,null);n.default=r.exports}}]);